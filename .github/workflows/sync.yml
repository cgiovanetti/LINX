
name: Sync main-samples with main (preserving samples)

on:
  push:
    branches:
      - main

jobs:
  sync-branches:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v2
        with:
          fetch-depth: 0
          
      - name: Sync main-samples with main
        run: |
          # Ensure we're on main and it's up to date
          git checkout main
          git pull origin main

          # Checkout samples
          git checkout samples
          git pull origin samples

          # Save current state of samples directory
          if [ -d "samples" ]; then
            mv samples samples_temp
          fi

          # Merge main into main-samples, preferring main for all files except samples
          git merge -X theirs --no-commit origin/main

          # Restore samples directory from main-samples
          if [ -d "samples_temp" ]; then
            rm -rf samples
            mv samples_temp samples
          fi

          # Stage all changes
          git add .

          # Commit if there are changes
          if git diff --staged --quiet; then
            echo "No changes to commit"
          else
            git commit -m "Sync main-samples with main, preserving samples"
          fi

          # Push changes
          git push https://${{ github.actor }}:${{ secrets.GITHUB_TOKEN }}@github.com/${{ github.repository }} samples
